<!--
template: /templates/page.html
buildScript: /scripts/getNotesLastFive.js
-->

<h1 class="sr-only">Home</h1>
<p>Hello from <span id="weather">sunny</span> Berlin!</p>
<section>
  <h2>Latest notes</h2>
  <ul role="list">
    <li>Notes go here</li>
  </ul>
  <a href="/notes">See all notes</a>
</section>
<script type="module">
  /**
   * Formats a date to an ISO string for the exact hour.
   *
   * For example:
   * - in: 2022-03-06T18:17:33.040Z (e.g. as IsO string, truly a Date object)
   * - out: 2022-03-06T18:00Z
   *
   * This is useful to help the brightsky API cache requests, instead of
   * sending a brand new request for each millisecond.
   **/
  function formatDate(date) {
    return `${
      date
        .toISOString() // 2022-03-06T18:17:33.040Z
        .slice(0, 13) // 2022-03-06T18
    }:00Z`; // 2022-03-06T18:00Z
  }
  async function getWeather() {
    const date = new Date();
    const thisHour = formatDate(date);
    const lastHour = formatDate(new Date(date - 1000 * 60 * 60));
    try {
      const res = await fetch(
        `https://api.brightsky.dev/weather?tz=Europe/Berlin&wmo_station_id=10384&date=${lastHour}&last_date=${thisHour}`
      );
      const data = await res.json();
      const weatherCode = data.weather[0].icon;
      switch (weatherCode) {
        case "clear-night":
        case "partly-cloudy-night":
          return "starry";
        case "clear-day":
          return "sunny";
        case "partly-cloudy-day":
        case "cloudy":
          return "cloudy";
        case "fog":
          return "foggy";
        case "wind":
          return "windy";
        case "rain":
          return "rainy";
        case "sleet":
          return "sleety";
        case "snow":
          return "snowy";
        case "hail":
          return "haily";
        case "thunderstorm":
          return "stormy";
        default:
          return null;
      }
    } catch (error) {
      return null;
    }
  }
  async function setWeather() {
    const weather = await getWeather();
    if (weather) {
      const weatherElement = document.getElementById("weather");
      weatherElement.innerText = weather;
    }
  }
  setWeather();
</script>
